"use strict";angular.module("App",["ui.router","firebase","ngRoute","app.directives.spinner"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/:roomId/:roomName/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/:roomId/:roomName",{templateUrl:"views/chat.html",controller:"ChatCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope",function(a){a.URL="https://lang-chat.firebaseio.com/chatRooms/",a.loggedIn=!1,a.loading=!1}]),angular.module("App").controller("HomeCtrl",["$scope","$rootScope","$firebaseArray","$location",function(a,b,c,d){var e=new Firebase(b.URL),f=c(e),g=!1;a.noPassword=!0,a.passwordVal="",a.newRoom=function(){f.$add({roomName:a.roomName,noPassword:a.noPassword,passwordVal:a.passwordVal}).then(function(c){var e=c.key();d.path("/"+e+"/"+a.roomName.toLowerCase().replace(/ /g,"-")),b.loggedIn=!0}),console.log(a.roomName+" created"),g=!0}}]),angular.module("App").controller("LoginCtrl",["$scope","$rootScope","$firebaseArray","$firebaseObject","$routeParams","$location",function(a,b,c,d,e,f){var g=new Firebase(b.URL+e.roomId),h=d(g);a.roomInfo=h,a.passwordCorrect=!1,h.$loaded(function(){a.passwordRequired=!h.noPassword,h.noPassword&&f.path(f.url().replace("/login","")),a.passwordSubmit=function(){a.passwordEntered===h.passwordVal?(console.log("correct"),a.passwordCorrect=!0,f.path(f.url().replace("/login","")),b.loggedIn=!0):(alert("incorrect"),a.passwordCorrect=!1,a.passwordEntered="")}})}]),angular.module("App").controller("ChatCtrl",["$rootScope","$scope","$firebaseArray","$firebaseObject","$http","$routeParams","$location",function(a,b,c,d,e,f,g){var h=new Firebase(a.URL+f.roomId),i=d(h);b.roomInfo=i;var j=c(h.child("chatMessages"));b.chatMessages=j,b.noTranslation=!1,b.usernameSelected=!1,b.stayAnon=!1,b.anonUsername="anon"+Math.floor(9e4*Math.random()+1e4),a.loading=!0,i.$loaded(function(){a.loggedIn===!1&&i.noPassword===!1&&g.path(g.url()+"/login"),b.roomName=i.roomName,a.loading=!1}),h.authAnonymously(function(a,b){a?console.log("Login Failed!",a):console.log("Authenticated successfully with payload:",b)});var k="trnsl.1.1.20150309T154331Z.204e43f2acbf0788.022db5406add6b3a68a6f48e8e956adcb8a0df24";e.get("https://translate.yandex.net/api/v1.5/tr.json/getLangs?key="+k+"&ui=en").success(function(a){b.langs=a.langs,b.selectedNativeLang="en",b.selectedTranslateLang="fr"}).error(function(a){console.log(a)}),b.submit=function(){function a(a){b.translatedMessage=a.text[0],b.stayAnon&&(b.name=b.anonUsername);var c=new Date,d=c.getHours(),e=c.getMinutes(),f=c.getSeconds();b.time=d+":"+e+":"+f,b.chatMessages.$add({user:b.name,anon:b.stayAnon,bodyOriginal:b.message,bodyTranslated:b.translatedMessage,time:b.time,from:b.selectedNativeLang,to:b.selectedTranslateLang}),b.usernameSelected=!0,b.message=""}b.noTranslation&&(b.selectedTranslateLang=b.selectedNativeLang),e.get("https://translate.yandex.net/api/v1.5/tr.json/translate?key="+k+"&lang="+b.selectedNativeLang+"-"+b.selectedTranslateLang+"&text="+b.message).success(function(b){a(b)}).error(function(a){console.log(a)})}}]),angular.module("app.directives.spinner",[]).directive("spinner",function(){return{restrict:"E",templateUrl:"views/directives/spinner.html"}});